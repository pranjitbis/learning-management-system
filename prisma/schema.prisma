generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id            Int                  @id @default(autoincrement())
  name          String
  email         String               @unique
  password      String
  role          String               @default("USER")
  createdAt     DateTime             @default(now())
  updatedAt     DateTime             @updatedAt
  access        Access[]
  certificates  Certificate[]
  progress      UserCourseProgress[]
  videoProgress UserVideoProgress[]
}

model Course {
  id           Int                  @id @default(autoincrement())
  title        String
  description  String
  price        Float
  category     String
  thumbnail    String?
  createdAt    DateTime             @default(now())
  updatedAt    DateTime             @updatedAt
  access       Access[]
  certificates Certificate[]
  progress     UserCourseProgress[]
  videos       Video[]
}

model Video {
  id                Int                 @id @default(autoincrement())
  title             String
  url               String
  duration          Int?                @default(0)
  published         Boolean             @default(true)
  position          Int?                @default(0)
  courseId          Int
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  userVideoProgress UserVideoProgress[]
  course            Course              @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([courseId], map: "Video_courseId_fkey")
}

model Access {
  id          Int       @id @default(autoincrement())
  userId      Int
  courseId    Int
  approved    Boolean   @default(false)
  requestedAt DateTime  @default(now())
  grantedAt   DateTime?
  course      Course    @relation(fields: [courseId], references: [id], onDelete: Cascade)
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, courseId])
  @@index([courseId], map: "Access_courseId_fkey")
}

model Certificate {
  id        Int      @id @default(autoincrement())
  userId    Int
  courseId  Int
  filePath  String
  issuedAt  DateTime @default(now())
  approved  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  course    Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([courseId], map: "Certificate_courseId_fkey")
  @@index([userId], map: "Certificate_userId_fkey")
}

model UserCourseProgress {
  id            Int       @id @default(autoincrement())
  userId        Int
  courseId      Int
  videosWatched Int
  totalVideos   Int
  completed     Boolean
  completedAt   DateTime?
  course        Course    @relation(fields: [courseId], references: [id])
  user          User      @relation(fields: [userId], references: [id])

  @@unique([userId, courseId])
  @@index([courseId], map: "UserCourseProgress_courseId_fkey")
}

model UserVideoProgress {
  id          Int       @id @default(autoincrement())
  userId      Int
  videoId     Int
  progress    Int       @default(0)
  completed   Boolean   @default(false)
  completedAt DateTime?
  lastUpdated DateTime  @updatedAt
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  video       Video     @relation(fields: [videoId], references: [id], onDelete: Cascade)

  @@unique([userId, videoId])
  @@index([videoId], map: "UserVideoProgress_videoId_fkey")
}

model hackthon {
    completedAt   DateTime?
    id    Int    @id @default(autoincrement())
  name  String
  email String @unique
    rank        Int?  
}
